{
  "description": "Create addresses caters for units/flats/shops",
  "processors": [
    {
      "script": {
        "source": "\n          def house_detail = null;\n          def unit_detail = null;\n          def street_detail = null;\n          def suburb_detail = null;\n          def locality_detail = null;\n          def postcode_detail = null;\n          def unit_type = null;\n          def habitation_name = null;\n          def level_detail = null;\n          // if unit identifier low is different to unit identifier high\n          if(ctx['unit_identifier_low'] != null && ctx['unit_identifier_high'] != null && ctx['unit_identifier_low'] != ctx['unit_identifier_high']) {\n            unit_detail = ctx['unit_identifier_low'] + '-' + ctx['unit_identifier_high'];\n          }\n          // if unit identifier low and high are the same then\n          if(ctx['unit_identifier_low'] != null && ctx['unit_identifier_low'] == ctx['unit_identifier_high']) {\n            unit_detail = ctx['unit_identifier_low'];\n          }\n          // if house low is same as house high and house low suffix is null and house high suffix is null\n          if(ctx['house_low'] != null && ctx['house_low'] == ctx['house_high'] && ctx['house_low_suffix'] == null && ctx['house_high_suffix'] == null) {\n            house_detail = ctx['house_low'];\n          }\n          // if house low is different to house high and house low suffix is null and house high suffix is null\n          if(ctx['house_low'] != null && ctx['house_high'] != null && ctx['house_low'] != ctx['house_high'] && ctx['house_low_suffix'] == null && ctx['house_high_suffix'] == null) {\n            house_detail = ctx['house_low'] + '-' + ctx['house_high'];\n          }\n          // if house low is same as house high and house low suffix is same as house high suffix\n          if(ctx['house_low'] != null && ctx['house_low'] == ctx['house_high'] && ctx['house_low_suffix'] != null && ctx['house_low_suffix'] == ctx['house_high_suffix']) {\n            house_detail = ctx['house_low'] + ctx['house_low_suffix'];\n          }\n          // if house low is same as house high and house low suffix is different to house high suffix\n          if(ctx['house_low'] != null && ctx['house_low_suffix'] != null && ctx['house_high'] != null && ctx['house_high_suffix'] != null && ctx['house_low'] == ctx['house_high'] && ctx['house_low_suffix'] != ctx['house_high_suffix']) {\n            house_detail = ctx['house_low'] + ctx['house_low_suffix'] + '-' + ctx['house_high'] + ctx['house_high_suffix'];\n          }\n          // if house low is different to house high and house low suffix is different to house high suffix\n          if(ctx['house_low'] != null && ctx['house_low_suffix'] != null && ctx['house_high'] != null && ctx['house_high_suffix'] != null && ctx['house_low'] != ctx['house_high'] && ctx['house_low_suffix'] != ctx['house_high_suffix']) {\n            house_detail = ctx['house_low'] + ctx['house_low_suffix'] + '-' + ctx['house_high'] + ctx['house_high_suffix'];\n          }\n          // street detail consists of street name, street type and street direction, with space between (and trimmed) e.g. if street direction is null then the space is not required after street type\n          if(ctx['street_direction'] == null) {\n            street_detail = ctx['street_name'] + ' ' + ctx['street_type'];\n          } else {\n            street_detail = ctx['street_name'] + ' ' + ctx['street_type'] + ' ' + ctx['street_direction'];\n          }\n          // if locality_type is suburb and the city_locality isnt the same then use the suburb field else suburb_detail should be blank. \n          if(ctx['locality_type'] != null && ctx['suburb'] != null && ctx['locality_type'] == \"SUBURB\" && ctx['locality_type'] != ctx['city_locality']) {\n            suburb_detail = ctx['suburb'];\n          }          \n          // if locality_type is null then use the suburb field.\n          if(ctx['locality_type'] == null && ctx['suburb'] != null)  {\n            suburb_detail = ctx['suburb'];\n          }\n          // if the locality_type is locality then the suburb field should be blank\n          // if the locality_type is locality then use the suburb field otherwise use the city_locality\n          if(ctx['locality_type'] != null && ctx['suburb'] != null && ctx['locality_type'] == \"LOCALITY\") {\n            suburb_detail = '';\n            locality_detail = ctx['suburb'];\n          } else {\n            locality_detail = ctx['city_locality'];\n          }\n          // if postcode zone has detail\n          if(ctx['postcode_zone'] != null) {\n            postcode_detail = ctx['postcode_zone'];\n          }\n          // unit_type\n          if(ctx['unit_type'] != null) {\n            unit_type = ctx['unit_type'];\n          }\n          // habitation_name\n          if (ctx['habitation_name'] != null) {\n            habitation_name = ctx['habitation_name'];\n          }\n          // level detail consists of level type and level number with space between and trimmed (either fied may contain data)\n          if (ctx['level_type'] != null && ctx['level_number'] != null) {\n            level_detail = ctx['level_type'] + ' ' + ctx['level_number'];\n          } \n          else if (ctx['level_type'] != null && ctx['level_number'] == null) {\n            level_detail = ctx['level_type'];\n          }\n          else if (ctx['level_type'] == null && ctx['level_number'] != null) {\n            level_detail = ctx['level_number'];\n          }\n\n          // if there is unit detail\n          if (unit_detail != null) {\n            ctx['address'] = unit_detail + '/' + house_detail + ' ' + street_detail + ' ' + suburb_detail + ' ' + locality_detail + ' ' + postcode_detail;\n          } else {\n            ctx['address'] = house_detail + ' ' + street_detail + ' ' + suburb_detail + ' ' +  locality_detail + ' ' + postcode_detail;\n          }\n          // if there is additional detail, commas to be formatted depending on what fields have data). this detail is appended to the address_string\n          if (unit_type != null && habitation_name == null && level_detail == null) {\n            ctx['address'] += ' (' + unit_type + ')';\n          } \n          else if (unit_type != null && habitation_name != null && level_detail == null) {\n            ctx['address'] += ' (' + unit_type + ',' + habitation_name + ')';\n          }\n          else if (unit_type != null && habitation_name != null && level_detail != null) {\n            ctx['address'] += ' (' + unit_type + ',' + habitation_name + ',' + level_detail + ')';\n          }\n          if (unit_type == null && habitation_name != null && level_detail == null) {\n            ctx['address'] += ' (' + habitation_name + ')';\n          } \n          else if (unit_type == null && habitation_name != null && level_detail != null) {\n            ctx['address'] += ' (' + habitation_name + ',' + level_detail + ')';\n          }\n          if (unit_type == null && habitation_name == null && level_detail != null) {\n            ctx['address'] += ' (' + level_detail + ')';\n          } \n          else if (unit_type != null && habitation_name == null && level_detail != null) {\n            ctx['address'] += ' (' + unit_type + ',' + level_detail + ')';\n          }\n          // suggester for now\n          ctx['address_suggest'] = ctx['address'];\n        "
      }
    }
  ]
}
